import json
import os
import urllib.request
import urllib.parse

def handler(event: dict, context) -> dict:
    '''Telegram –±–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏ –ò–ò –®–û–£ –ë–ï–ó –®–ò–†–ú–´'''
    
    method = event.get('httpMethod', 'POST')
    
    if method == 'OPTIONS':
        return {
            'statusCode': 200,
            'headers': {
                'Access-Control-Allow-Origin': '*',
                'Access-Control-Allow-Methods': 'POST, OPTIONS',
                'Access-Control-Allow-Headers': 'Content-Type'
            },
            'body': ''
        }
    
    if method != 'POST':
        return {
            'statusCode': 405,
            'headers': {'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*'},
            'body': json.dumps({'error': 'Method not allowed'})
        }
    
    try:
        body = json.loads(event.get('body', '{}'))
        message = body.get('message', {})
        chat_id = message.get('chat', {}).get('id')
        text = message.get('text', '').strip().lower()
        
        if not chat_id:
            return {'statusCode': 200, 'body': json.dumps({'ok': True})}
        
        bot_token = os.environ.get('TELEGRAM_SUPPORT_BOT_TOKEN')
        
        if not bot_token:
            return {
                'statusCode': 200,
                'headers': {'Content-Type': 'application/json'},
                'body': json.dumps({'ok': True, 'message': 'Bot token not configured'})
            }
        
        if text == '/start' or text == 'start':
            response_text = '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ó–∞–¥–∞–π—Ç–µ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏ –ò–ò –®–û–£ –ë–ï–ó –®–ò–†–ú–´.'
            send_telegram_message(bot_token, chat_id, response_text)
        
        elif '–∫–æ–≥–¥–∞' in text or '–≥–¥–µ' in text or '–∞–¥—Ä–µ—Å' in text or '–¥–∞—Ç–∞' in text or '–≤—Ä–µ–º—è' in text:
            response_text = '''üìÖ –ö–æ–≥–¥–∞ –∏ –≥–¥–µ?

üóì –î–∞—Ç–∞: 18 –∞–ø—Ä–µ–ª—è 2026 –≥–æ–¥–∞
üïê –í—Ä–µ–º—è: 10:00 - 18:00
üìç –ì–æ—Ä–æ–¥: –í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫, –ü—Ä–∏–º–æ—Ä—Å–∫–∏–π –∫—Ä–∞–π

–¢–æ—á–Ω—ã–π –∞–¥—Ä–µ—Å –ø–ª–æ—â–∞–¥–∫–∏ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ email –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏ –±–∏–ª–µ—Ç–∞.'''
            send_telegram_message(bot_token, chat_id, response_text)
        
        elif '—Ü–µ–Ω–∞' in text or '—Å—Ç–æ–∏–º–æ—Å—Ç—å' in text or '–±–∏–ª–µ—Ç' in text or '—Å–∫–æ–ª—å–∫–æ' in text or '—Å—Ç–æ–∏—Ç' in text:
            response_text = '''üí≥ –°—Ç–æ–∏–º–æ—Å—Ç—å –±–∏–ª–µ—Ç–æ–≤

üí∞ –û—Ç 1,000 ‚ÇΩ

üéØ –í–∞–∂–Ω–æ: 100% —Å—Ä–µ–¥—Å—Ç–≤ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –ö–ì–ö–£ ¬´–ú–∞—è–∫¬ª ‚Äî –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ü–µ–Ω—Ç—Ä –ø–æ–º–æ—â–∏ —Å–µ–º—å–µ –∏ –¥–µ—Ç—è–º.

–ü–æ–∫—É–ø–∞—è –±–∏–ª–µ—Ç, –≤—ã –Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ–ª—É—á–∞–µ—Ç–µ –∑–Ω–∞–Ω–∏—è, –Ω–æ –∏ –ø–æ–º–æ–≥–∞–µ—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–º –ª—é–¥—è–º!'''
            send_telegram_message(bot_token, chat_id, response_text)
        
        elif '–ø—Ä–æ–≥—Ä–∞–º–º–∞' in text or '—á—Ç–æ –±—É–¥–µ—Ç' in text or '–∫–æ–Ω—Ç–µ–Ω—Ç' in text or '–º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ' in text:
            response_text = '''üéØ –ü—Ä–æ–≥—Ä–∞–º–º–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è

üî• 8+ –ò–ò-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –≤ –¥–µ–π—Å—Ç–≤–∏–∏:
‚Ä¢ ChatGPT, Claude, Midjourney
‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å–∞
‚Ä¢ –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å –ò–ò

üë• –ñ–∏–≤—ã–µ –∫–µ–π—Å—ã –æ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–µ–π
ü§ù –ù–µ—Ç–≤–æ—Ä–∫–∏–Ω–≥ —Å –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏–∫–∞–º–∏
üì∏ –ù–µ–π—Ä–æ-—Ñ–æ—Ç–æ—Å–µ—Å—Å–∏—è –¥–ª—è –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
üéÅ –†–æ–∑—ã–≥—Ä—ã—à –ø—Ä–∏–∑–æ–≤ –æ—Ç —Å–ø–æ–Ω—Å–æ—Ä–æ–≤

üí° –í—ã –Ω–∞—É—á–∏—Ç–µ—Å—å –ø—Ä–∏–º–µ–Ω—è—Ç—å –ò–ò –¥–ª—è —Å–≤–æ–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞ –ø—Ä—è–º–æ –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏!'''
            send_telegram_message(bot_token, chat_id, response_text)
        
        elif '—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è' in text or '–∑–∞–ø–∏—Å–∞—Ç—å—Å—è' in text or '–∫—É–ø–∏—Ç—å' in text or '–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è' in text:
            response_text = '''üé´ –ö–∞–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è?

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –Ω–∞—à —Å–∞–π—Ç
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–∏–º—è, email, —Ç–µ–ª–µ—Ñ–æ–Ω)
3. –û–ø–ª–∞—Ç–∏—Ç–µ –±–∏–ª–µ—Ç (–æ—Ç 1,000 ‚ÇΩ)
4. –ü–æ–ª—É—á–∏—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞ email

‚ö°Ô∏è –û—Å—Ç–∞–ª–æ—Å—å –º–∞–ª–æ –º–µ—Å—Ç! –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏–¥—ë—Ç –±—ã—Å—Ç—Ä–æ.

üìû –ò–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–º:
–¢–µ–ª–µ—Ñ–æ–Ω: +7-981-129-24-99'''
            send_telegram_message(bot_token, chat_id, response_text)
        
        elif '–±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å' in text or '–¥–µ–Ω—å–≥–∏' in text or '–ø–æ–º–æ—â—å' in text or '–∫—É–¥–∞' in text:
            response_text = '''üíö –ë–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

üéØ 100% —Å—Ä–µ–¥—Å—Ç–≤ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –ö–ì–ö–£ ¬´–ú–∞—è–∫¬ª ‚Äî –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ü–µ–Ω—Ç—Ä –ø–æ–º–æ—â–∏ —Å–µ–º—å–µ –∏ –¥–µ—Ç—è–º.

üë©‚Äçüëß –ö–æ–º—É –ø–æ–º–æ–≥–∞–µ–º?
–¶–µ–Ω—Ç—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–µ–º—å–∏ –∏ –¥–µ—Ç–µ–π –≤ –ü—Ä–∏–º–æ—Ä—Å–∫–æ–º –∫—Ä–∞–µ:
‚Ä¢ –ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–∞—è –ø–æ–º–æ—â—å
‚Ä¢ –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
‚Ä¢ –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
‚Ä¢ –ü–æ–º–æ—â—å –≤ —Ç—Ä—É–¥–Ω–æ–π –∂–∏–∑–Ω–µ–Ω–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏

üìä –ü–æ—Å–ª–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –æ–ø—É–±–ª–∏–∫—É–µ–º –æ—Ç—á—ë—Ç –æ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤–∞—Ö.'''
            send_telegram_message(bot_token, chat_id, response_text)
        
        elif '–æ–ø—ã—Ç' in text or '–Ω–æ–≤–∏—á–æ–∫' in text or '–Ω–∞—á–∏–Ω–∞—é—â' in text or '–Ω—É–∂–µ–Ω' in text:
            response_text = '''üéì –ù—É–∂–µ–Ω –ª–∏ –æ–ø—ã—Ç?

‚úÖ –ù–ï–¢, –æ–ø—ã—Ç –Ω–µ –Ω—É–∂–µ–Ω!

–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤—Å–µ—Ö:
‚Ä¢ –ù–æ–≤–∏—á–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ç–æ–ª—å–∫–æ —Å–ª—ã—à–∞–ª–∏ –ø—Ä–æ –ò–ò
‚Ä¢ –¢–µ—Ö, –∫—Ç–æ —É–∂–µ –ø—Ä–æ–±–æ–≤–∞–ª ChatGPT
‚Ä¢ –ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç—è—Ç –≤–Ω–µ–¥—Ä–∏—Ç—å –ò–ò
‚Ä¢ –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤, –∂–µ–ª–∞—é—â–∏—Ö —É–≥–ª—É–±–∏—Ç—å –∑–Ω–∞–Ω–∏—è

üí° –ú—ã –ø–æ–∫–∞–∂–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≤ –¥–µ–π—Å—Ç–≤–∏–∏ –∏ –æ–±—ä—è—Å–Ω–∏–º –∫–∞–∫ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—à–∞–≥–æ–≤–æ.'''
            send_telegram_message(bot_token, chat_id, response_text)
        
        elif '–≤–æ–∑–≤—Ä–∞—Ç' in text or '–æ—Ç–º–µ–Ω–∞' in text or '–≤–µ—Ä–Ω—É—Ç—å' in text:
            response_text = '''üí∏ –í–æ–∑–≤—Ä–∞—Ç –±–∏–ª–µ—Ç–æ–≤

‚úÖ –î–æ 10 –∞–ø—Ä–µ–ª—è 2026: –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –±–∏–ª–µ—Ç –∏ –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤

‚ùå –ü–æ—Å–ª–µ 10 –∞–ø—Ä–µ–ª—è: –≤–æ–∑–≤—Ä–∞—Ç –Ω–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ —Å—Ä–µ–¥—Å—Ç–≤–∞ —É–∂–µ –ø–µ—Ä–µ–¥–∞–Ω—ã –≤ –±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—É—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é

üìù –î–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω +7-981-129-24-99'''
            send_telegram_message(bot_token, chat_id, response_text)
        
        elif '–∫–æ–Ω—Ç–∞–∫—Ç' in text or '—Å–≤—è–∑–∞—Ç—å—Å—è' in text or '–æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä' in text or '—Ç–µ–ª–µ—Ñ–æ–Ω' in text:
            response_text = '''üìû –°–≤—è–∑–∞—Ç—å—Å—è —Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–º

üë§ –®–∫–æ–ª–∞ ¬´–•–∞–∫–Ω–∏ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏¬ª

üì± –¢–µ–ª–µ—Ñ–æ–Ω: +7-981-129-24-99
üèô –ì–æ—Ä–æ–¥: –í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫

‚è∞ –û—Ç–≤–µ—á–∞–µ–º: –ü–Ω-–ü—Ç: 10:00 - 19:00 (–ú–°–ö+7)'''
            send_telegram_message(bot_token, chat_id, response_text)
        
        else:
            response_text = '''–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–æ–ø—Ä–æ—Å! –í–æ—Ç —á—Ç–æ —è –º–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏ –ò–ò –®–û–£ –ë–ï–ó –®–ò–†–ú–´:

üìÖ –ö–æ–≥–¥–∞ –∏ –≥–¥–µ?
üí≥ –°—Ç–æ–∏–º–æ—Å—Ç—å –±–∏–ª–µ—Ç–æ–≤
üéØ –ü—Ä–æ–≥—Ä–∞–º–º–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
üé´ –ö–∞–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è?
üíö –ë–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
üéì –ù—É–∂–µ–Ω –ª–∏ –æ–ø—ã—Ç?
üí∏ –í–æ–∑–≤—Ä–∞—Ç –±–∏–ª–µ—Ç–æ–≤
üìû –°–≤—è–∑–∞—Ç—å—Å—è —Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–º

–ó–∞–¥–∞–π—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å –¥—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, –∏ —è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–æ–º–æ–≥—É!'''
            send_telegram_message(bot_token, chat_id, response_text)
        
        return {
            'statusCode': 200,
            'headers': {'Content-Type': 'application/json'},
            'body': json.dumps({'ok': True})
        }
    
    except Exception as e:
        return {
            'statusCode': 500,
            'headers': {'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*'},
            'body': json.dumps({'error': str(e)})
        }


def send_telegram_message(bot_token: str, chat_id: int, text: str) -> bool:
    '''–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram'''
    try:
        url = f'https://api.telegram.org/bot{bot_token}/sendMessage'
        data = {
            'chat_id': chat_id,
            'text': text
        }
        
        req = urllib.request.Request(
            url,
            data=json.dumps(data).encode('utf-8'),
            headers={'Content-Type': 'application/json'}
        )
        
        with urllib.request.urlopen(req) as response:
            response.read()
        return True
    except Exception:
        return False