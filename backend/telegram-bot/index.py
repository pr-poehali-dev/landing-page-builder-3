import json
import os
import urllib.request
import urllib.parse

def handler(event: dict, context) -> dict:
    '''Telegram –±–æ—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏ –ò–ò –®–û–£ –ë–ï–ó –®–ò–†–ú–´'''
    
    method = event.get('httpMethod', 'POST')
    
    if method == 'OPTIONS':
        return {
            'statusCode': 200,
            'headers': {
                'Access-Control-Allow-Origin': '*',
                'Access-Control-Allow-Methods': 'POST, OPTIONS',
                'Access-Control-Allow-Headers': 'Content-Type'
            },
            'body': ''
        }
    
    if method != 'POST':
        return {
            'statusCode': 405,
            'headers': {'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*'},
            'body': json.dumps({'error': 'Method not allowed'})
        }
    
    try:
        body = json.loads(event.get('body', '{}'))
        print(f'Received body: {json.dumps(body)}')
        
        message = body.get('message', {})
        chat_id = message.get('chat', {}).get('id')
        text = message.get('text', '').strip().lower()
        
        print(f'Chat ID: {chat_id}, Text: {text}')
        
        if not chat_id:
            print('No chat_id, returning ok')
            return {'statusCode': 200, 'body': json.dumps({'ok': True})}
        
        bot_token = os.environ.get('TELEGRAM_BOT_TOKEN_NEW') or os.environ.get('TELEGRAM_BOT_TOKEN')
        
        if not bot_token:
            print('ERROR: Bot token not found in environment')
            return {
                'statusCode': 200,
                'headers': {'Content-Type': 'application/json'},
                'body': json.dumps({'ok': True, 'message': 'Bot token not configured'})
            }
        
        print(f'Bot token found, sending message to chat {chat_id}')
        
        if text == '/start':
            response_text = '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ. –ó–∞–¥–∞–π—Ç–µ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å'
            send_telegram_message(bot_token, chat_id, response_text)
        
        elif text in ['1', '1Ô∏è‚É£', '–∫–æ–≥–¥–∞', '–≥–¥–µ', '–∞–¥—Ä–µ—Å', '–¥–∞—Ç–∞', '–≤—Ä–µ–º—è']:
            response_text = '''üìÖ **–ö–æ–≥–¥–∞ –∏ –≥–¥–µ?**

üóì **–î–∞—Ç–∞:** 18 –∞–ø—Ä–µ–ª—è 2026 –≥–æ–¥–∞
üïê **–í—Ä–µ–º—è:** 10:00 - 18:00
üìç **–ì–æ—Ä–æ–¥:** –í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫, –ü—Ä–∏–º–æ—Ä—Å–∫–∏–π –∫—Ä–∞–π

–¢–æ—á–Ω—ã–π –∞–¥—Ä–µ—Å –ø–ª–æ—â–∞–¥–∫–∏ –∏ —Å—Ö–µ–º–∞ –ø—Ä–æ–µ–∑–¥–∞ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ email –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏ –±–∏–ª–µ—Ç–∞.

–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: 43.1155, 131.8855'''
            send_telegram_message(bot_token, chat_id, response_text)
        
        elif text in ['2', '2Ô∏è‚É£', '—Ü–µ–Ω–∞', '—Å—Ç–æ–∏–º–æ—Å—Ç—å', '–±–∏–ª–µ—Ç', '—Å–∫–æ–ª—å–∫–æ']:
            response_text = '''üí≥ **–°—Ç–æ–∏–º–æ—Å—Ç—å –±–∏–ª–µ—Ç–æ–≤**

üí∞ **–û—Ç 1,000 ‚ÇΩ**

üéØ **–í–∞–∂–Ω–æ:** 100% —Å—Ä–µ–¥—Å—Ç–≤ –æ—Ç –ø—Ä–æ–¥–∞–∂–∏ –±–∏–ª–µ—Ç–æ–≤ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –¶–µ–Ω—Ç—Ä ¬´–ñ–∏–≤–∞—è –ù–∞–¥–µ–∂–¥–∞¬ª ‚Äî –±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—É—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–º–æ–≥–∞–µ—Ç –æ–¥–∏–Ω–æ–∫–∏–º –º–∞—Ç–µ—Ä—è–º –≤ –ü—Ä–∏–º–æ—Ä—å–µ.

–ü–æ–∫—É–ø–∞—è –±–∏–ª–µ—Ç, —Ç—ã –Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ–ª—É—á–∞–µ—à—å –∑–Ω–∞–Ω–∏—è, –Ω–æ –∏ –ø–æ–º–æ–≥–∞–µ—à—å —Ä–µ–∞–ª—å–Ω—ã–º –ª—é–¥—è–º! üíö'''
            send_telegram_message(bot_token, chat_id, response_text)
        
        elif text in ['3', '3Ô∏è‚É£', '–ø—Ä–æ–≥—Ä–∞–º–º–∞', '—á—Ç–æ –±—É–¥–µ—Ç', '–∫–æ–Ω—Ç–µ–Ω—Ç']:
            response_text = '''üéØ **–ü—Ä–æ–≥—Ä–∞–º–º–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è**

üî• **8+ –ò–ò-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤** –≤ –¥–µ–π—Å—Ç–≤–∏–∏:
‚Ä¢ ChatGPT, Claude, Midjourney
‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å–∞
‚Ä¢ –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å –ò–ò

üë• **–ñ–∏–≤—ã–µ –∫–µ–π—Å—ã** –æ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–µ–π

ü§ù **–ù–µ—Ç–≤–æ—Ä–∫–∏–Ω–≥** —Å –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏–∫–∞–º–∏

üì∏ **–ù–µ–π—Ä–æ-—Ñ–æ—Ç–æ—Å–µ—Å—Å–∏—è** –¥–ª—è –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

üéÅ **–†–æ–∑—ã–≥—Ä—ã—à –ø—Ä–∏–∑–æ–≤** –æ—Ç —Å–ø–æ–Ω—Å–æ—Ä–æ–≤

üí° **–ü—Ä–∞–∫—Ç–∏–∫–∞:** –Ω–∞—É—á–∏—à—å—Å—è –ø—Ä–∏–º–µ–Ω—è—Ç—å –ò–ò –¥–ª—è —Å–≤–æ–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞ –∏–ª–∏ —Ä–∞–±–æ—Ç—ã –ø—Ä—è–º–æ –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏!'''
            send_telegram_message(bot_token, chat_id, response_text)
        
        elif text in ['4', '4Ô∏è‚É£', '—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è', '–∑–∞–ø–∏—Å–∞—Ç—å—Å—è', '–∫—É–ø–∏—Ç—å']:
            response_text = '''üé´ **–ö–∞–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è?**

1. –ü–µ—Ä–µ–π–¥–∏ –Ω–∞ –Ω–∞—à —Å–∞–π—Ç
2. –ó–∞–ø–æ–ª–Ω–∏ —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–∏–º—è, email, —Ç–µ–ª–µ—Ñ–æ–Ω)
3. –û–ø–ª–∞—Ç–∏ –±–∏–ª–µ—Ç (–æ—Ç 1,000 ‚ÇΩ)
4. –ü–æ–ª—É—á–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞ email —Å –¥–µ—Ç–∞–ª—è–º–∏

‚ö°Ô∏è **–û—Å—Ç–∞–ª–æ—Å—å –º–∞–ª–æ –º–µ—Å—Ç!** –í—Å–µ–≥–æ 300 –º–µ—Å—Ç, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏–¥—ë—Ç –±—ã—Å—Ç—Ä–æ.

üìû **–ò–ª–∏ —Å–≤—è–∂–∏—Å—å —Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–º:**
–¢–µ–ª–µ—Ñ–æ–Ω: +7-981-129-24-99
Telegram: @chernikovgpt'''
            send_telegram_message(bot_token, chat_id, response_text)
        
        elif text in ['5', '5Ô∏è‚É£', '–±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å', '–¥–µ–Ω—å–≥–∏', '–ø–æ–º–æ—â—å']:
            response_text = '''üíö **–ë–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**

üéØ **100% —Å—Ä–µ–¥—Å—Ç–≤** –æ—Ç –ø—Ä–æ–¥–∞–∂–∏ –±–∏–ª–µ—Ç–æ–≤ –∏–¥—É—Ç –≤ –¶–µ–Ω—Ç—Ä ¬´–ñ–∏–≤–∞—è –ù–∞–¥–µ–∂–¥–∞¬ª

üë©‚Äçüëß **–ö–æ–º—É –ø–æ–º–æ–≥–∞–µ–º?**
–¶–µ–Ω—Ç—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–¥–∏–Ω–æ–∫–∏—Ö –º–∞—Ç–µ—Ä–µ–π –≤ –ü—Ä–∏–º–æ—Ä—Å–∫–æ–º –∫—Ä–∞–µ, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—è:
‚Ä¢ –ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—É—é –ø–æ–º–æ—â—å
‚Ä¢ –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É
‚Ä¢ –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
‚Ä¢ –ü–æ–º–æ—â—å –≤ —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ

üìä **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å:** –ü–æ—Å–ª–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –æ–ø—É–±–ª–∏–∫—É–µ–º –æ—Ç—á—ë—Ç –æ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤–∞—Ö.

–ü–æ–∫—É–ø–∞—è –±–∏–ª–µ—Ç, —Ç—ã –¥–µ–ª–∞–µ—à—å —Ä–µ–∞–ª—å–Ω–æ–µ –¥–æ–±—Ä–æ–µ –¥–µ–ª–æ! üôè'''
            send_telegram_message(bot_token, chat_id, response_text)
        
        elif text in ['6', '6Ô∏è‚É£', '–æ–ø—ã—Ç', '–Ω–æ–≤–∏—á–æ–∫', '–¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö']:
            response_text = '''üéì **–ù—É–∂–µ–Ω –ª–∏ –æ–ø—ã—Ç?**

‚úÖ **–ù–ï–¢, –æ–ø—ã—Ç –Ω–µ –Ω—É–∂–µ–Ω!**

–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤—Å–µ—Ö:
‚Ä¢ –ù–æ–≤–∏—á–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ç–æ–ª—å–∫–æ —Å–ª—ã—à–∞–ª–∏ –ø—Ä–æ –ò–ò
‚Ä¢ –¢–µ—Ö, –∫—Ç–æ —É–∂–µ –ø—Ä–æ–±–æ–≤–∞–ª ChatGPT
‚Ä¢ –ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç—è—Ç –≤–Ω–µ–¥—Ä–∏—Ç—å –ò–ò
‚Ä¢ –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤, –∂–µ–ª–∞—é—â–∏—Ö —É–≥–ª—É–±–∏—Ç—å –∑–Ω–∞–Ω–∏—è

üí° –ú—ã –ø–æ–∫–∞–∂–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≤ –¥–µ–π—Å—Ç–≤–∏–∏ –∏ –æ–±—ä—è—Å–Ω–∏–º, –∫–∞–∫ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—à–∞–≥–æ–≤–æ, –¥–∞–∂–µ –µ—Å–ª–∏ —Ç—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª —Å –Ω–µ–π—Ä–æ—Å–µ—Ç—è–º–∏.

–ì–ª–∞–≤–Ω–æ–µ ‚Äî –∂–µ–ª–∞–Ω–∏–µ —É—á–∏—Ç—å—Å—è! üöÄ'''
            send_telegram_message(bot_token, chat_id, response_text)
        
        elif text in ['7', '7Ô∏è‚É£', '–≤–æ–∑–≤—Ä–∞—Ç', '–æ—Ç–º–µ–Ω–∞', '–≤–µ—Ä–Ω—É—Ç—å']:
            response_text = '''üí∏ **–í–æ–∑–≤—Ä–∞—Ç –±–∏–ª–µ—Ç–æ–≤**

‚úÖ **–î–æ 10 –∞–ø—Ä–µ–ª—è 2026:**
–ú–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –±–∏–ª–µ—Ç –∏ –ø–æ–ª—É—á–∏—Ç—å **–ø–æ–ª–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç** —Å—Ä–µ–¥—Å—Ç–≤

‚ùå **–ü–æ—Å–ª–µ 10 –∞–ø—Ä–µ–ª—è:**
–í–æ–∑–≤—Ä–∞—Ç –Ω–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ —Å—Ä–µ–¥—Å—Ç–≤–∞ —É–∂–µ –ø–µ—Ä–µ–¥–∞–Ω—ã –≤ –±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—É—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é

üìù **–ö–∞–∫ –≤–µ—Ä–Ω—É—Ç—å:**
–ù–∞–ø–∏—à–∏ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω +7-981-129-24-99 –∏–ª–∏ Telegram @chernikovgpt —Å —É–∫–∞–∑–∞–Ω–∏–µ–º:
‚Ä¢ –§–ò–û –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
‚Ä¢ Email
‚Ä¢ –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞'''
            send_telegram_message(bot_token, chat_id, response_text)
        
        elif text in ['8', '8Ô∏è‚É£', '–∫–æ–Ω—Ç–∞–∫—Ç', '—Å–≤—è–∑–∞—Ç—å—Å—è', '–æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä', '–≤–æ–ø—Ä–æ—Å']:
            response_text = '''üìû **–°–≤—è–∑–∞—Ç—å—Å—è —Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–º**

üë§ **–®–∫–æ–ª–∞ ¬´–•–∞–∫–Ω–∏ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏¬ª**

üì± **–¢–µ–ª–µ—Ñ–æ–Ω:** +7-981-129-24-99
üí¨ **Telegram:** @chernikovgpt
üèô **–ì–æ—Ä–æ–¥:** –í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫

‚è∞ **–û—Ç–≤–µ—á–∞–µ–º:**
–ü–Ω-–ü—Ç: 10:00 - 19:00 (–ú–°–ö+7)
–°–±-–í—Å: –ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

–ï—Å–ª–∏ —É —Ç–µ–±—è –µ—Å—Ç—å –æ—Å–æ–±—ã–π –≤–æ–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —É–∫–∞–∑–∞–Ω –≤ –º–µ–Ω—é ‚Äî –Ω–∞–ø–∏—à–∏ –Ω–∞–ø—Ä—è–º—É—é! –ú—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–æ–º–æ–∂–µ–º! üòä'''
            send_telegram_message(bot_token, chat_id, response_text)
        
        else:
            response_text = '''‚ùì –ù–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è–ª —Ç–≤–æ–π –≤–æ–ø—Ä–æ—Å.

–ü–æ–ø—Ä–æ–±—É–π –≤—ã–±—Ä–∞—Ç—å –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:

1Ô∏è‚É£ –ö–æ–≥–¥–∞ –∏ –≥–¥–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ?
2Ô∏è‚É£ –°–∫–æ–ª—å–∫–æ —Å—Ç–æ—è—Ç –±–∏–ª–µ—Ç—ã?
3Ô∏è‚É£ –ß—Ç–æ –±—É–¥–µ—Ç –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏?
4Ô∏è‚É£ –ö–∞–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è?
5Ô∏è‚É£ –ö—É–¥–∞ –∏–¥—É—Ç –¥–µ–Ω—å–≥–∏ –æ—Ç –±–∏–ª–µ—Ç–æ–≤?
6Ô∏è‚É£ –ù—É–∂–µ–Ω –ª–∏ –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã —Å –ò–ò?
7Ô∏è‚É£ –ú–æ–∂–Ω–æ –ª–∏ –≤–µ—Ä–Ω—É—Ç—å –±–∏–ª–µ—Ç?
8Ô∏è‚É£ –°–≤—è–∑–∞—Ç—å—Å—è —Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–º

–ò–ª–∏ –Ω–∞–ø–∏—à–∏ –≤–æ–ø—Ä–æ—Å –ø–æ-–¥—Ä—É–≥–æ–º—É! üòä'''
            send_telegram_message(bot_token, chat_id, response_text)
        
        return {
            'statusCode': 200,
            'headers': {'Content-Type': 'application/json'},
            'body': json.dumps({'ok': True})
        }
    
    except Exception as e:
        return {
            'statusCode': 500,
            'headers': {'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*'},
            'body': json.dumps({'error': str(e)})
        }


def send_telegram_message(bot_token: str, chat_id: int, text: str) -> bool:
    '''–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram'''
    try:
        url = f'https://api.telegram.org/bot{bot_token}/sendMessage'
        data = {
            'chat_id': chat_id,
            'text': text,
            'parse_mode': 'Markdown'
        }
        
        print(f'Sending to Telegram API: {url}')
        print(f'Data: chat_id={chat_id}, text_length={len(text)}')
        
        req = urllib.request.Request(
            url,
            data=json.dumps(data).encode('utf-8'),
            headers={'Content-Type': 'application/json'}
        )
        
        with urllib.request.urlopen(req) as response:
            result = response.read()
            print(f'Telegram API response: {result.decode("utf-8")}')
        return True
    except Exception as e:
        print(f'ERROR sending message: {type(e).__name__}: {str(e)}')
        return False